<!DOCTYPE html>
<html>
<head>
    <title>Video Compressor by IGTTS</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .file-progress {
            margin-bottom: 15px;
        }
        progress {
            width: 300px;
            height: 20px;
        }
    </style>
</head>
<body>

<div class="container">


<h2>Video Compressor PRO</h2>

<input type="file" id="videos" multiple accept=".mp4"><br><br>

<select id="codec">
    <option value="libx264">igtts.264 (Fast)</option>
    <!-- <option value="libx265">H.265 (Smaller)</option> -->
</select><br><br>

<button onclick="startCompression()">Compress</button>

<div id="progress-container"></div>
<h3>Downloads:</h3>
<div id="downloads"></div>


<footer class="app-footer">
    <hr>
    <p>
        Â© <span id="year"></span> : IGTTS - Your tools for everyday life
    </p>
    <p class="footer-links">
        <a href="https://github.com/converterpro" target="_blank">GitHub</a>
        .
        <a href="#" onclick="alert('Contact: info@igtts.com')">Contact</a>
    </p>
</footer>

<script>
    document.getElementById("year").textContent = new Date().getFullYear();
</script>




</div>

<script>
async function startCompression() {
    const files = document.getElementById("videos").files;
    const codec = document.getElementById("codec").value;

    if (files.length === 0) {
        alert("Please select at least one video.");
        return;
    }

    document.getElementById("progress-container").innerHTML = "";
    document.getElementById("downloads").innerHTML = "";

    // Create progress bars for each file
    const fileProgress = {};
    for (let i = 0; i < files.length; i++) {
        const div = document.createElement("div");
        div.className = "file-progress";
        div.innerHTML = `<strong>${files[i].name}</strong><br>
                         <progress id="progress-${i}" value="0" max="100"></progress>
                         <span id="percent-${i}">0%</span>`;
        document.getElementById("progress-container").appendChild(div);
        fileProgress[files[i].name] = i;
    }

    // Upload files via FormData
    const formData = new FormData();
    for (let file of files) {
        formData.append("videos", file);
    }
    formData.append("codec", codec);

    // Start compression
    const response = await fetch("/start", {
        method: "POST",
        body: formData
    });
    const data = await response.json();
    const taskId = data.task_id;

    // Poll server for progress
    const interval = setInterval(async () => {
        const res = await fetch(`/status/${taskId}`);
        const status = await res.json();

        if (status.status === "processing") {
            const idx = fileProgress[status.file];
            document.getElementById(`progress-${idx}`).value = status.percent;
            document.getElementById(`percent-${idx}`).innerText = status.percent + "%";
        } else if (status.status === "done") {
            clearInterval(interval);
            // Show download links
            const downloadsDiv = document.getElementById("downloads");
            for (let file of status.files) {
                const a = document.createElement("a");
                a.href = `/download/${file}`;
                a.innerText = file;
                a.download = file;
                downloadsDiv.appendChild(a);
                downloadsDiv.appendChild(document.createElement("br"));
            }
        }
    }, 500); // poll every 0.5s
}
</script>


</body>
</html>
