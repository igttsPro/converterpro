<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/style.css">
    <title>IGTTS</title>
    <style>
        .file-progress {
            margin-bottom: 15px;
        }
        progress {
            width: 300px;
            height: 20px;
        }
    </style>
</head>

<body>
<!-- NAVBAR (full width, outside container) -->
<header class="top-header">
     <h2>MEDIA TOOLBOX</h2>
    <nav class="navbar">
        <!-- Logo -->
        <a href="#" class="nav-logo">
            <img src="/static/images/logo.jpg" alt="Company Logo">
        </a>

        <!-- Hamburger Menu Button (Mobile Only) -->
        <button class="hamburger-menu" id="hamburger" aria-label="Toggle menu">
            <!-- <span></span> -->
            <span></span>
            <!-- <span></span> -->
        </button>

        <!-- Navigation Links -->
        <ul class="nav-links">
            <!-- VideoTools Dropdown -->
            <li class="dropdown">
                <a href="/">VideoTools &#9662;</a> <!-- Only ONE arrow here -->
                <ul class="dropdown-menu">
                    <li><a href="/">Compress Video</a></li>
                    <li><a href="/split">Split Video</a></li>
                    <li><a href="/download">Download Video</a></li>
                    <li><a href="/remove-bg">Remove VideoBground</a></li>
                    <li><a href="/video-to-text">Video Voice to Text</a></li>
                </ul>
            </li>

            <!-- Image Tools -->
            <li class="dropdown">
                <a href="#">ImageTools &#9662;</a> <!-- Only ONE arrow here -->
                <ul class="dropdown-menu">
                    <li><a href="/remove-image-bg">Remove ImageBground</a></li>
                    <li><a href="/image-to-text">Image to Text</a></li>
                </ul>
            </li>
            <!-- Other Tools (Add more as needed) -->
        </ul>

        <!-- Profile Ring -->
        <a href="#" class="profile-ring">
            <svg viewBox="0 0 120 120" class="ring-text">
                <defs>
                    <path id="circlePath"
                          d="M 60,60 m -46,0 a 46,46 0 1,1 92,0 a 46,46 0 1,1 -92,0"/>
                </defs>
                <text>
                    <textPath href="#circlePath">
                        IGTTS • PRODUCT ARCHITECT & ENGINEER •
                    </textPath>
                </text>
            </svg>
            <img src="/static/images/profile.png" alt="Author Profile">
        </a>
    </nav>
</header>


<main class="main-wrapper">
    <div class="container">


    <h2>Video Compressor PRO</h2>

    <input type="file" id="videos" multiple accept=".mp4"><br><br>

    <select id="codec">
        <option value="libx264">igtts.(FastDip)</option>
        <!-- <option value="libx265">igtts.(SlowDip)</option> -->
    </select><br><br>

    <button onclick="startCompression()">Compress</button>

    <div id="progress-container"></div>
    <h3>Downloads:</h3>
    <div id="downloads"></div>
</main>


<footer class="app-footer">
    <hr>
    <p>
        © <span id="year"></span> : IGTTS - Your tools for everyday life
    </p>
    <p class="footer-links">
        <a href="https://github.com/converterpro" target="_blank">GitHub</a>
        .
        <a href="#" onclick="alert('Contact: info@igtts.com')">Contact</a>
    </p>
</footer>

<script>
    document.getElementById("year").textContent = new Date().getFullYear();
</script>




</div>

<script>
async function startCompression() {
    const files = document.getElementById("videos").files;
    const codec = document.getElementById("codec").value;

    if (files.length === 0) {
        alert("Please select at least one video.");
        return;
    }

    document.getElementById("progress-container").innerHTML = "";
    document.getElementById("downloads").innerHTML = "";

    // Create progress bars for each file
    const fileProgress = {};
    for (let i = 0; i < files.length; i++) {
        const div = document.createElement("div");
        div.className = "file-progress";
        div.innerHTML = `<strong>${files[i].name}</strong><br>
                         <progress id="progress-${i}" value="0" max="100"></progress>
                         <span id="percent-${i}">0%</span>`;
        document.getElementById("progress-container").appendChild(div);
        fileProgress[files[i].name] = i;
    }

    // Upload files via FormData
    const formData = new FormData();
    for (let file of files) {
        formData.append("videos", file);
    }
    formData.append("codec", codec);

    // Start compression
    const response = await fetch("/start", {
        method: "POST",
        body: formData
    });
    const data = await response.json();
    const taskId = data.task_id;

    // Poll server for progress
    const interval = setInterval(async () => {
        const res = await fetch(`/status/${taskId}`);
        const status = await res.json();

        if (status.status === "processing") {
            const idx = fileProgress[status.file];
            document.getElementById(`progress-${idx}`).value = status.percent;
            document.getElementById(`percent-${idx}`).innerText = status.percent + "%";
        } else if (status.status === "done") {
            clearInterval(interval);
            // Show download links
            const downloadsDiv = document.getElementById("downloads");
            for (let file of status.files) {
                const a = document.createElement("a");
                a.href = `/download/${file}`;
                a.innerText = file;
                a.download = file;
                downloadsDiv.appendChild(a);
                downloadsDiv.appendChild(document.createElement("br"));
            }
        }
    }, 500); // poll every 0.5s
}
</script>


<script src="/static/js/main.js"></script>

</body>
</html>
